language: go
go_import_path: github.com/ethereum/go-ethereum
sudo: false
matrix:
  include:
  - os: linux
    dist: xenial
    go: 1.13.x
    script:
    - go run build/ci.go install
    - travis_wait 60 go run build/ci.go test
    before_deploy:
    - sh build/deploy.sh
    deploy:
      provider: releases
      api_key:
        secure: ltQwkQ/caal89PnH0VoYj/Exl55QlQbN0yGSeqwKttdU+LCXIuDMnSXWZBws/5HAV++90o4xc4lBri6FWDmy3pQbBVauDAIysK8dRbawcp5T97xF7uTpT5KKY/W0CW3MjAoeSIJYX+Xbig6g4hMySUFsMJQKsfc6A4kWMX8zO7Wa3FpBvm3d7NNp6Cwue1M0Tv2voTsDO9/LUGrANIQ4Qso0NX4fBtthA2psMplkRxZHhs65D8Qll0/zsvK/IYrisqRnk6tIOxwlhoPbKQEfDFeGwuIUkCuXUahsRKSF0akLxRchZIaEMGuL68PXjA+Uu+aT1Ca1yxVBg4rn+3vIikoN7suVYw8DCX1Kse1PyiAi7nTRq4hupUBguo19sIsd/ZbXp2iag5W59R7g+2JUw7swIkmzUo7Dx547aAOkH5DFLETuLuXUqikyQsugI98/jgrfaqnEV/zpX63So0s6M4UwbL4U5+3whX9yVmHalmEr0q4GqXwr3qhvCvmgIp5FnCsIbZOM7vJlQQWwzqv9ttObjwYDNtpYeS/Bj4wAU0eUpGl7AZQ/gE539mv5gOmklyz6b+Tbvf1T8r19SbbW0c6iHaohSZmrGRqSOwJFh5c1isc2vhMAqaM5u7ZqQiQ1BgO4oLMGD6nxEqJgxC2vzpSmHHCB7G9CS8EhlbHEqOY=
      file: multi-geth*-$TRAVIS_OS_NAME.*
      file_glob: true
      draft: true
      on:
        repo: meowsbits/multi-geth
        tags: true
      skip_cleanup: true
      tag_name: "$TRAVIS_TAG"
  - os: linux
    dist: xenial
    sudo: required
    go: 1.13.x
    env:
      - ARMv5 
    git:
      submodules: false # avoid cloning ethereum/tests
    addons:
      apt:
        packages:
          - gcc-multilib
    script:
      # Switch over GCC to cross compilation (breaks 386, hence why do it here only)
      - sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install gcc-arm-linux-gnueabi libc6-dev-armel-cross gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gcc-aarch64-linux-gnu libc6-dev-arm64-cross
      - sudo ln -s /usr/include/asm-generic /usr/include/asm
      - GOPATH=~/go_arm GOARM=5 go run build/ci.go install -arch arm -cc arm-linux-gnueabi-gcc
    before_deploy:
      - sh build/deploy_arm.sh
    deploy:
      provider: releases
      api_key:
        secure: ltQwkQ/caal89PnH0VoYj/Exl55QlQbN0yGSeqwKttdU+LCXIuDMnSXWZBws/5HAV++90o4xc4lBri6FWDmy3pQbBVauDAIysK8dRbawcp5T97xF7uTpT5KKY/W0CW3MjAoeSIJYX+Xbig6g4hMySUFsMJQKsfc6A4kWMX8zO7Wa3FpBvm3d7NNp6Cwue1M0Tv2voTsDO9/LUGrANIQ4Qso0NX4fBtthA2psMplkRxZHhs65D8Qll0/zsvK/IYrisqRnk6tIOxwlhoPbKQEfDFeGwuIUkCuXUahsRKSF0akLxRchZIaEMGuL68PXjA+Uu+aT1Ca1yxVBg4rn+3vIikoN7suVYw8DCX1Kse1PyiAi7nTRq4hupUBguo19sIsd/ZbXp2iag5W59R7g+2JUw7swIkmzUo7Dx547aAOkH5DFLETuLuXUqikyQsugI98/jgrfaqnEV/zpX63So0s6M4UwbL4U5+3whX9yVmHalmEr0q4GqXwr3qhvCvmgIp5FnCsIbZOM7vJlQQWwzqv9ttObjwYDNtpYeS/Bj4wAU0eUpGl7AZQ/gE539mv5gOmklyz6b+Tbvf1T8r19SbbW0c6iHaohSZmrGRqSOwJFh5c1isc2vhMAqaM5u7ZqQiQ1BgO4oLMGD6nxEqJgxC2vzpSmHHCB7G9CS8EhlbHEqOY=
      file: multi-geth*-arm.*
      file_glob: true
      draft: true
      on:
        repo: meowsbits/multi-geth
        tags: true
      skip_cleanup: true
      tag_name: "$TRAVIS_TAG"
  - os: osx
    go: 1.13.x
    script:
    - echo "Increase the maximum number of open file descriptors on macOS"
    - NOFILE=20480
    - sudo sysctl -w kern.maxfiles=$NOFILE
    - sudo sysctl -w kern.maxfilesperproc=$NOFILE
    - sudo launchctl limit maxfiles $NOFILE $NOFILE
    - sudo launchctl limit maxfiles
    - ulimit -S -n $NOFILE
    - ulimit -n
    - unset -f cd
    - go run build/ci.go install
    before_deploy:
    - sh build/deploy.sh
    deploy:
      provider: releases
      api_key:
        secure: LAMAOVzTJc2FQx5+MpJh/FL+6x7W8e4kQTMzqZV0bY/yS2xYUo2Oq9LlWWAAPHxi4Vo6X6Uuqh76VczyMmONJiMf5hKVNmW2jOOWIvTFvaDebIxvvX4f5KURdhsgFR3Z/UCeq86IDKZUkjI1rezp9QuTRY7AL8L7gqFG8cq6KBVbHODALOdtuN/iP8E016llE2IiQlMdD5Njw4CC7eiIqubiy7lerECo2213DXoI1lPI+DV0z0gnK42++ZSUdxG4ewsobiPqrpCeEEeqzvUMsWNADV0Aaye28kyUj9bglyTkM4mT1jmK/wM6OCfGQDRsoi9g48/yPjZ9m/TP8MK5fPBSk1um43N/ucmfXcl/ahbbdx440YsXqNTd/9jLeWlH4D7d4rDbFxAyh+JTnfTrz7/hvdE1tkMDvoGci7U8X4W+vJz6G2RTyGx2MLzfLCOYn2z3cBt3eRNhCsrTr4Xt1Gefd29UERDDEZNM4/yQd0P0C6nAdCunB/gOdowNCeyUcx2xnijXuyIFrq1J4PtXQBTA98nCKQCTWLfZbjZeJJOEp97ReiwIGHVgyT2gIcB8YN/Th7V3yTNiaNjzkdiGd85lWLAqTIWoXdTlmVDFg/3oJXioM/JS3whSyWi8m5ftR4lDIOl08M2wZXF+qSUfwUrV73kpIz5NXXcK2zVcslc=
      file: multi-geth*-$TRAVIS_OS_NAME.*
      file_glob: true
      draft: true
      on:
        repo: meowsbits/multi-geth
        tags: true
      skip_cleanup: true
      tag_name: "$TRAVIS_TAG"
  - os: linux
    dist: xenial
    go: 1.13.x
    env:
    - lint
    git:
      submodules: false
    script:
    - go run build/ci.go lint
